<% if (title) { %>
    <h1 class="detail-title"><%= title %></h1>
<% } else { res.redirect('/') } %>

<%- messages() %>

<%- listing %>

<!-- Vehicle Image Gallery Enhancement -->
<% if (galleryImages && galleryImages.length > 0) { %>
  <section class="vehicle-gallery">
    <h2>Image Gallery</h2>
    <div class="gallery-grid">
      <% galleryImages.forEach(function(img) { %>
        <div class="gallery-item">
          <img src="<%= img.image_url %>" alt="<%= img.image_alt || 'Vehicle image' %>" style="max-width:200px;max-height:150px;" />
          <% if (img.image_alt) { %><div class="gallery-caption"><%= img.image_alt %></div><% } %>
        </div>
      <% }) %>
    </div>
  </section>
<% } %>

<% if (locals.accountData && (locals.accountData.account_type === 'Employee' || locals.accountData.account_type === 'Admin')) { %>
  <section class="gallery-upload">
    <h3>Add Image to Gallery</h3>
    <form action="/inv/detail/<%= inventoryId %>/add-image" method="POST">
      <label>Image URL: <input type="url" name="image_url" required placeholder="/images/vehicles/example.jpg" pattern="^/images/vehicles/.*"></label>
      <label>Alt Text: <input type="text" name="image_alt" maxlength="100" placeholder="Description (optional)"></label>
      <input type="hidden" name="inventoryId" value="<%= inventoryId %>">
      <button type="submit">Add Image</button>
    </form>
  </section>
<% } %>

<style>
.vehicle-gallery { margin: 2em 0; }
.gallery-grid { display: flex; flex-wrap: wrap; gap: 1em; }
.gallery-item { border: 1px solid #ccc; padding: 0.5em; background: #fafafa; }
.gallery-caption { font-size: 0.9em; color: #555; text-align: center; margin-top: 0.5em; }
</style>